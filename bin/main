#!/usr/bin/env ruby
load 'lib/logic.rb'
load 'lib/player.rb'

board_array = [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ']
player_turn = 1

puts 'Welcome to our tic-tac-toe game, to start, enter your names'

puts 'Player 1, enter your name: '
name1 = gets.chomp
valid = validate_user_name(name1)
while !valid
  puts "Your name shouldn't contain any spaces and can't be empty"
  name1 = gets.chomp
  valid = validate_user_name(name1)
end
puts 'Player 2, enter your name: '
name2 = gets.chomp
valid = validate_user_name(name2)
while !valid
  puts "Your name shouldn't contain any spaces and can't be empty"
  name2 = gets.chomp
  valid = validate_user_name(name2)
end
game_finished = false

player1 = Player.new(name1)
player2 = Player.new(name2)

while !game_finished
  puts "Here's the board:"
  print_board(board_array)
  if player_turn == 1
    puts "#{player1.get_name}, select which cell you want to fill by writing it's cell number"
    current_player_name = player1.get_name
  else
    puts "#{player2.get_name}, select which cell you want to fill by writing it's cell number"
    current_player_name = player2.get_name
  end

  output = " "
  while output != ""
    number = gets.chomp
    number = number.to_i - 1
    output = validate_input_board_cell(board_array,player_turn,number)

    puts output
  end
  
  board_array[number] = "X" if player_turn == 1
  board_array[number] = "O" if player_turn == 2

  winner = win(board_array, player_turn, current_player_name)
  if winner != ""
    print_board(board_array)
    puts winner
    puts "Score:"
    puts "#{player1.get_name}: #{player1.get_score}"
    puts "#{player2.get_name}: #{player2.get_score}"
    puts "Do you want to play again [y/n]"
    play_again = gets.chomp
    valid_input = false
    while !valid_input
      valid_input = validate_input_play_again(play_again)
      if !valid_input
        puts "Please only write 'y' or 'n'"
        play_again = gets.chomp
      end
    end
    break unless play_again == "y"

    unless output == "Tie"
      if player_turn == 1
        player1.increase_score()
      else
        player2.increase_score()
      end
    end
    board_array = [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ']
  end
  if player_turn == 1
    player_turn = 2
  else
    player_turn = 1
  end

end